<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>MIRA-ENC v1</title>

<link rel="stylesheet" href="style.css">
<script type="text/javascript" src="common.js"></script>

<script type="text/javascript">

function jsOnLoad(){
	jsInitMenu(2);
	jsInit();
	jsGET('media.json', jsLoadDone);
}

function jsInit(){
	var e=jsGetE("slMdHeader")[0];
	var i;
	for(i=0;i<10;i++){
		jsAddOpt(e,i,i);
	}
	e.value=0;
}

function jsLoadDone(rspText){
	var json = JSON.parse(rspText);

	jsUdLbl("lblHdCnt",json,"hdCnt");
	var hdList = json["hdList"];
	jsGetEId("lblHdList").innerHTML = hdList.toString();
	var arr = json["midList"];
	if ((arr != null) && (arr.length > 0)) {
		jsGetEId("lblMdCnt").innerHTML = arr.length;
		slMid = json["slMid"];
		var e = jsGetE("slMid")[0];
		for(i = 0;i < arr.length; i++){
			var opt=document.createElement("option");
			var v = arr[i];
			opt.text=v;
			opt.value=v;
			if (v == slMid) {
				opt.selected = true;
			}
			e.add(opt);
		}
		jsMidChanged(slMid);
	}
}

function udTime(eN,j,dN){
	var x=j[dN];
	var dt=new Date(x * 1000);
	str = dt.getFullYear() + "-" + (dt.getMonth() + 1) + "-" + dt.getDate() + " " +
	dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();
	jsGetE(eN)[0].value = str;
}

function jsGetMediaDone(rspText){
	var json = JSON.parse(rspText);

	jsUdTxt("slMdMode",json,"mode");
	jsUdTxt("txtMdPrio",json,"prio");
	jsUdTxt("slMdHeader",json,"header");

	udTime("txtMdCreated", json, "created");
	udTime("txtMdStart", json, "start");
	udTime("txtMdExpired", json, "expired");

	jsUdTxt("slMdRepeat",json,"repeat");
	jsUdTxt("txtMdDays",json,"days");
	jsUdTxt("txtMdTime",json,"time");
	var d=json["days"];
	var i;
	for(i=0;i<7;i++){
		jsGetEId("chkD"+i).checked=(d&(1<<i))!=0;
	}
	jsUdLbl("lblMdAudio",json,"audio");
	jsUdLbl("lblMdStatus",json,"status");
}

function jsMidChanged(id){
	jsGetE("slMdMode")[0].value=0;
	jsGetE("txtMdPrio")[0].value=0;
	jsGetE("txtMdCreated")[0].value="";
	jsGetE("txtMdExpired")[0].value="";
	jsGetE("txtMdStart")[0].value="";
	jsGetE("slMdRepeat")[0].value=0;
	jsGetE("txtMdDays")[0].value=0;
	jsGetE("txtMdTime")[0].value="";
	jsGetEId("lblMdAudio").value="";
	jsGetEId("lblMdStatus").value="";
	jsGET("media2.json?mid="+id,jsGetMediaDone);
}

function jsSubmit(cmd){
	jsCreateTxt("MdCmd",cmd);
	document.forms[0].submit();
}

function jsDelete(opt){
	if (confirm("Are you sure to delete media?")){
		jsSubmit(opt);
	}
}
</script>
</head>

<body onload="jsOnLoad();">

<div id="header">
</div>

<div id="nav">
</div>


<div id="content">
	<form id="idForm" method="post">
		<table style="padding-left:30px">
			<tr class="bh">
				<td class="tdh" colspan="2">Media information</td>
			</tr>
			<tr>
				<td  class="small">Header ID list (<label id="lblHdCnt"></label>)</td>
				<td><label id="lblHdList"></label></td>
			</tr>
			<tr>
				<td>Media count</td>
				<td><label id="lblMdCnt"></label></td>
			</tr>
			<tr>
				<td>Select Media</td>
				<td>
					<select name="slMid" onchange="jsMidChanged(this.value)">
					</select>
				</td>
			</tr>
			<tr>
				<td>Mode</td>
				<td>
					<select name="slMdMode">
						<option value="0">OFF</option>
						<option value="1" selected>SCHEDULE</option>
						<option value="2">IMMEDIATE</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>Priority</td>
				<td>
					<input name="txtMdPrio" type="number" min="0" max="255" value="1"/>
				</td>
			</tr>
			<tr>
				<td>Header ID</td>
				<td>
					<select name="slMdHeader">
					</select>
				</td>
			</tr>
			<tr>
				<td>Created</td>
				<td><input name="txtMdCreated" type="text"></td>
			</tr>
			<tr>
				<td>Expired</td>
				<td><input name="txtMdExpired" type="text"></td>
			</tr>
			<tr>
				<td>Start</td>
				<td><input name="txtMdStart" type="text"></td>
			</tr>
			<tr>
				<td>Repeat type</td>
				<td>
					<select name="slMdRepeat">
						<option value="0" selected>Weekly</option>
						<option value="1">Monthly</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>Active Days</td>
				<td>
					<input name="txtMdDays">
					<input id="chkD0" type="checkbox" checked onchange="jsMdDayChanged()"/>Monday&nbsp;
					<input id="chkD1" type="checkbox" checked/>Tuesday&nbsp;
					<input id="chkD2" type="checkbox" checked/>Wednesday&nbsp;
					<input id="chkD3" type="checkbox" checked/>Thursday&nbsp;
					<input id="chkD4" type="checkbox" checked/>Friday&nbsp;
					<input id="chkD5" type="checkbox" checked/>Saturday&nbsp;
					<input id="chkD6" type="checkbox" checked/>Sunday
				</td>
			</tr>
			<tr>
				<td>Play time in day</td>
				<td><input name="txtMdTime" style="width:400px" value="8:00,12:00,18:00"></td>
			</tr>
			<tr>
				<td>Audio information</td>
				<td><label id="lblMdAudio" /></td>
			</tr>
			<tr>
				<td>Status</td>
				<td><label id="lblMdStatus" /></td>
			</tr>
			<tr class="bh"><td colspan="2" /></tr>
		</table>

		<p style="text-align:left">
			<input type="button" onclick="jsSubmit(1);" value="Play"/>
			<input type="button" onclick="jsSubmit(4);" value="Stop"/>
			<!-- <input type="button" onclick="jsSubmit(5);" value="Add to Playlist"/> -->
			<input type="button" onclick="jsDelete(2);" value="Delete"/>
			<input type="button" onclick="jsDelete(3);" value="Delete All"/>
		</p>

	</form>
</div>
</body>
</html>