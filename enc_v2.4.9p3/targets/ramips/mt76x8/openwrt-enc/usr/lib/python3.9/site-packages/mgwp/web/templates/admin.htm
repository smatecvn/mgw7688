<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>MIRA-ENC v1</title>

<link rel="stylesheet" href="style.css">
<script type="text/javascript" src="common.js"></script>

<script type="text/javascript">
var CMD_PASS=1,CMD_RTC=3,CMD_REBOOT=4,CMD_RESET=5,CMD_EXIT=6;

function jsOnLoad(){
	jsInitMenu(6);
	jsGET('admin.json', jsLoadDone);
	setInterval('jsUdTime()',1000);
}

function jsLoadDone(rspText){
	jsUdTime();
	var json = JSON.parse(rspText);
	if (json["postRet"]){
		alert("Success!");
	}
}

function jsUdTime(){
	var dt=new Date();
	var x=dt.getDate()+"/"+parseInt(dt.getMonth()+1)+"/"+dt.getFullYear()+" "+
		dt.getHours()+":"+dt.getMinutes()+":"+dt.getSeconds();
	jsGetEId("lblRtc").innerHTML=x;
}

function jsBtPass(){
	if (jsGetE("txtPassOld")[0].value.length==0){
		alert("Please enter the old password!");
		return false;
	}
	obj=jsGetE("txtPassNew")[0].value;
	if ((obj.length==0)||(obj!=jsGetE("txtPassNewCfn")[0].value)){
		alert("Invalid new password!");
		return false;
	}
	jsGetE("txtCmd")[0].value=CMD_PASS;
	document.forms[0].submit();
}

function jsBtTime(){
	var dt=new Date();
	jsGetE("txtCmd")[0].value=CMD_RTC;
	var x=parseInt(dt.getTime() / 1000);
	jsGetE("txtRtc")[0].value=x;
	document.forms[0].submit();
}

function jsBtReboot(){
	if(confirm("Are you sure to reboot device?")){
		jsGetE("txtCmd")[0].value=CMD_REBOOT;
		document.forms[0].submit();
	}
}

function jsBtRestart(){
	if(confirm("Are you sure to restart mgwp-app?")){
		jsGetE("txtCmd")[0].value=CMD_EXIT;
		document.forms[0].submit();
	}
}

function jsBtReset(){
	if (jsGetE("txtPassOld")[0].value.length==0){
		alert("Please enter the old password!");
		return false;
	}
	if(confirm("All data will be lost, are you sure to reset?")){
		jsGetE("txtCmd")[0].value=CMD_RESET;
		document.forms[0].submit();
	}
}
</script>
</head>

<body onload="jsOnLoad();">

<div id="header">
</div>

<div id="nav">
</div>

<div id="content">
	<form id="idForm" method="post" onSubmit="jsPreSubmit();">
		<table>
			<tr class="bh">
				<td class="tdh" colspan="2">Security</td>
			</tr>
			<tr>
				<td style="width:20%">Current password</td>
				<td><input type="password" name="txtPassOld"></td>
			</tr>
			<tr>
				<td>New password</td>
				<td><input type="password" name="txtPassNew"></td>
			</tr>
			<tr>
				<td>Confirm</td>
				<td><input type="password" name="txtPassNewCfn"></td>
			</tr>
			<tr>
				<td>Current PC time</td>
				<td><label id="lblRtc">--</label></td>
			</tr>
			<tr class="bh"><td colspan="2" /></tr>
		</table>

		<p style="text-align:left">
			<input type="text" name="txtCmd" value="0" hidden>
			<input type="text" name="txtRtc" value="0" hidden>
			<input type="button" onclick="jsBtPass()" value="Change Password"/>&nbsp;
			<input type="button" onclick="jsBtTime()" value="Set Time"/>&nbsp;
			<input type="button" onclick="jsBtReboot()" value="Reboot MIRA"/>&nbsp;
			<input type="button" onclick="jsBtRestart()" value="Restart App"/>&nbsp;
			<input type="button" onclick="jsBtReset()" value="Factory Reset"/>
		</p>
	</form>
</div>
</body>
</html>