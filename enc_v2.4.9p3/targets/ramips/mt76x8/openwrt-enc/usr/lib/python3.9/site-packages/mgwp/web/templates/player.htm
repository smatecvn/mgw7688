<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>MIRA-ENC v1</title>

<link rel="stylesheet" href="style.css">
<script type="text/javascript" src="common.js"></script>

<script type="text/javascript">
var xmlHttp;
var autoReload=true;
var slMid = 0, slChunk = 0, slTs = 0;

function jsOnLoad(){
	jsInitMenu(3);
	jsReload(slMid, slChunk, slTs);
	setInterval('jsTimer()', 1000);
}

function jsReload(mid, chunk, ts){
	jsGET("player.json?mid=" + mid + "&chunk=" + chunk + "&ts=" + ts, jsLoadDone);
}

function jsTimer(){
	if(autoReload){
    if (slMid > 0) {
		  jsReload(slMid, slChunk, slTs);
    }
	}
}

function jsLoadDone(rspText){
	var json = JSON.parse(rspText);

	jsUdLbl("lblPlaying",json,"playing");
	jsUdLbl("lblDetail",json,"detail");

	var slArr = json["selected"];
	var slStr = "";
	if ((slArr != null) && (slArr.length > 2)) {
		slMid = parseInt(slArr[0]);
		slChunk = parseInt(slArr[1]);
    slTs = parseInt(slArr[2]);
		slStr = slArr[0] + ", " + slArr[1] + ", " + slArr[2];
	} else {
    slMid = 0;
  }

	arr = json["playlist"];
  var slPlaylist =jsGetE("slPlaylist")[0];
  var lblCnt = jsGetEId("lblPlCnt");
	if ((arr != null) && (arr.length > 0)) {
		lblCnt.innerHTML = arr.length;
		slPlaylist.options.length = 0;
		for(i=0;i<arr.length;i++){
			var opt=document.createElement("option");
			var md = arr[i];
			var val = md[0] + ", " + md[1] + ", " + md[2];
			opt.text = val;
			opt.value= val;
			if(opt.text == slStr){
				opt.selected=true;
			}
			slPlaylist.add(opt);
		}
	} else {
    lblCnt.innerHTML = 0;
    slPlaylist.options.length = 0;
  }
}

function jsMidChanged(slStr){
	if (slStr != null) {
		var slStrArr = slStr.split(",");
		if (slStrArr.length >= 3) {
			slMid = parseInt(slStrArr[0]);
			slChunk = parseInt(slStrArr[1]);
      ts = parseInt(slStrArr[2]);
			jsReload(slMid, slChunk, ts);
		}
	}
}

function jsSubmit(cmd){
	jsCreateTxt("PlayCmd",cmd);
	jsCreateTxt("PlayId",jsGetEId("lblPlaying").innerHTML);
	document.forms[0].submit();
}
</script>
</head>

<body onload="jsOnLoad();">

<div id="header">
</div>

<div id="nav">
</div>


<div id="content">
	<form id="idForm" method="post">
		<table style="padding-left:30px">
			<tr>
				<td>Playing Media</td>
				<td><label id="lblPlaying"></label></td>
			</tr>
			<tr>
				<td class="small">Playlist (count=<label id="lblPlCnt">0</label>)</td>
				<td>
					<select name="slPlaylist" onchange="jsMidChanged(this.value)">
					</select>
				</td>
			</tr>
			<tr>
				<td>Details</td>
				<td><label id="lblDetail"></label></td>
			</tr>
			<tr class="bh"><td colspan="2" /></tr>
		</table>

		<p style="text-align:left">
			<input type="button" onclick="jsSubmit(4);" value="Stop"/>
		</p>

	</form>
</div>
</body>
</html>